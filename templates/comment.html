{{define "comment"}}
<div class="comments-section">
    <h3>Comments</h3>
    {{range .Comments}}
    <div class="comment">
        <p class="comment-meta">User: {{.UserName}} | Date: {{.CreatedAt}}</p>
        <div class="comment-content">
            <p class="comment-text">{{.Content}}</p>
            {{if index $.CanModifyComment .Comment.ID}}
            <div class="comment-actions">
                <button type="button"
                        class="edit-btn"
                        data-id="{{.ID}}"
                        data-content="{{.Content | html}}">
                    ✏️
                </button>
                <form class="delete-form" action="/delete_comment/{{.ID}}" method="POST">
                    <button type="submit" class="delete-btn"
                            onclick="return confirm('Are you sure you want to delete this comment?')">
                        🗑️
                    </button>
                </form>
            </div>
            {{end}}
        </div>

        <!-- Кнопки лайків -->
        {{if $.CurrentUser}}
        <form action="/like" method="POST">
            <input type="hidden" name="content_type" value="comment">
            <input type="hidden" name="content_id" value="{{.ID}}">

            <button type="submit" name="reaction" value="like"
                    class="reaction-btn like-btn {{if eq .UserReaction "like"}}active{{end}}">
            👍 Like {{.Likes}}
            </button>
            <button type="submit" name="reaction" value="dislike"
                    class="reaction-btn dislike-btn {{if eq .UserReaction "dislike"}}active{{end}}">
            👎 Dislikes {{.Dislikes}}
            </button>
        </form>
        {{else}}
        <div class="reaction-buttons">
            <button disabled class="inactive">👍 Like {{.Likes}}</button>
            <button disabled class="inactive">👎 Dislikes {{.Dislikes}}</button>
        </div>
        {{end}}
        <div>
           <!-- Reply button -->
            {{if $.CurrentUser}}
            <div class="reply-container">
                <button class="reply-btn" data-comment-id="{{.ID}}">↩️ Reply</button>

                <form class="reply-form" method="POST" style="display: none; margin-top:10px;">
                    <input type="hidden" name="parent_comment_id" value="{{.ID}}">
                    <input type="hidden" name="post_id" value="{{$.Post.ID}}">
                    <textarea name="reply_content" rows="3" placeholder="Write your reply..."></textarea>
                    <button type="submit" class="submit-reply-btn">Send Reply</button>
                </form>
            </div>
            {{end}}
        </div>
       <!-- Show answers -->
        {{with index $.Replies .Comment.ID}}
        <div class="replies" style="margin-left: 30px;">
            {{range .}}
            <div class="comment reply">
                <p class="comment-meta">User: {{.UserName}} | Date: {{.CreatedAt}}</p>
                <div class="comment-content">
                    <p class="comment-text">{{.Content}}</p>
                </div>
            </div>
            {{end}}
        </div>
        {{end}}

    </div>
    {{else}}
    <p>No comments yet.</p>
    {{end}}
</div>

<!-- Edit Comment Modal -->
<div id="editCommentModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Edit comment</h2>
            <span class="close-btn" id="closeModalBtn">&times;</span>
        </div>
        <form id="editCommentForm">
            <input type="hidden" id="commentId" name="commentId">
            <textarea id="commentContent" name="commentContent" rows="6" placeholder="Edit comment..."></textarea>
            <div class="modal-actions">
                <button type="submit" class="save-btn">💾 Save</button>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript to show/hide response form -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".reply-btn").forEach(function (btn) {
      btn.addEventListener("click", function () {
        const container = this.closest(".reply-container");
        const form = container.querySelector(".reply-form");
        if (!form) return;
        form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
      });
    });
  });
</script>
{{end}}
